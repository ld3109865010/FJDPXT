
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>电子客票打印换开</title>
    <link href="~/Content/bootstrap-4.1.3-dist/css/bootstrap.min.css" rel="stylesheet import" />
    <!--系统维护样式表-->
    <link href="~/Content/css/ElectronicsTicket.css" rel="stylesheet" />
    <style>
        .myContent > div {
            height: 50px;
            border: 1px solid;
            text-align: center;
            font-size: 12px;
            overflow: hidden; /*溢出隐藏*/
        }
    </style>
</head>
<body>
    <div class="container pb-5">
        <h4 class="text-center py-3">打印换开</h4>
        <div class="content p-3">
            <!--.col- 针对所有设备-->
            <div class="row mt-3 myContent">
                <!--第一行-->
                <div class="col-1" style="border-bottom:none">填开单位:<br> ISSUED BY</div>
                <div class="col-2" style="border-bottom:none; border-left:none; font-weight: bolder;">中国东方航空公司<br>CHINA EASTERN AIRLINES</div>
                <div class="col-2" style="border-bottom:none; border-left:none; line-height:48px;">客票</div>
                <div class="col-2" style="border-bottom:none; border-left:none;">始发地/目的地:<br>ORIGIN/DESTINATION</div>
                <div class="col-2" style="border-bottom:none; border-left:none; line-height:48px;font-weight: bolder;" id="dLine"></div>
                <div class="col-3" style="border-bottom:none; border-left:none;">出票日期和地点:<br>DETE AND PLACE ISSUE</div>

                <!--第二行-->
                <div class="col-3" style="border-bottom:none;">签注<br>RESTRICTION/ENDORSEMENTS（CARBON）</div>
                <div class="col-2" style="border-bottom:none; border-left:none; border-top:none;">PASSENGER TICKET</div>
                <div class="col-2" style="border-bottom:none; border-left:none;">定座记录编号:<br>BOOKING REFERENCE</div>
                <div class="col-2" style="border-bottom:none; border-left:none; line-height:48px;font-weight: bolder;" id="dSeatNu"></div>
                <div class="col-3" style="border-bottom:none; border-left:none; line-height:48px;font-weight: bolder;" id="dTimeAndStation"></div>

                <!--第三行-->
                <div class="col-3" style="border-bottom:none;">旅客姓名（不得转让）<br>NAME OF PASSENGER NOT TRANSFERABLE</div>
                <div class="col-2" style="border-bottom:none; border-left:none;">旅客编号<br />LVKE BIANHAO</div>
                <div class="col-2" style="border-bottom:none; border-left:none; line-height:48px;font-weight: bolder;" id="dPassengerNo"></div>
                <div class="col-2" style="border-bottom:none; border-left:none;">换开凭证<br>ISSUED IN EXCHANGE FDR</div>
                <div class="col-3" style="border-bottom:none; border-left:none;">营业员<br>AGENT </div>

                <!--第四行-->
                <div class="col-3" style="border-bottom:none; line-height:48px;font-weight: bolder;" id="dPassengerName"></div>
                <div class="col-2" style="border-bottom:none; border-left:none;">连续客票<br>CONJUNCTTON TTCKET(S)</div>
                <div class="col-2" style="border-bottom:none; border-left:none; line-height:48px;font-weight: bolder;"></div>
                <div class="col-2" style="border-bottom:none; border-left:none; line-height:48px;font-weight: bolder;"></div>
                <div class="col-3" style="border-bottom:none; border-left:none; line-height:48px;font-weight: bolder;" id="dUserName"></div>

                <!--第五行-->
                <div class="col-2" style="border-bottom:none;background-color:#EFEFEF">仅在票面上所列航班作为运输使用</div>
                <div class="col-1" style="border-bottom:none; border-left:none;line-height:48px;background-color:#EFEFEF">承运人</div>
                <div class="col-1" style="border-bottom:none; border-left:none;line-height:48px;background-color:#EFEFEF">航班号</div>
                <div class="col-1" style="border-bottom:none; border-left:none;line-height:48px;background-color:#EFEFEF">座位等级</div>
                <div class="col-1" style="border-bottom:none; border-left:none;line-height:48px;background-color:#EFEFEF">日期</div>
                <div class="col-1" style="border-bottom:none; border-left:none;line-height:48px;background-color:#EFEFEF">时间</div>
                <div class="col-1" style="border-bottom:none; border-left:none;line-height:48px;background-color:#EFEFEF">订座情况</div>
                <div class="col-1" style="border-bottom:none; border-left:none;background-color:#EFEFEF">票价级别/<br /> 客票类别</div>
                <div class="col-1" style="border-bottom:none; border-left:none;background-color:#EFEFEF">客票生效日期</div>
                <div class="col-1" style="border-bottom:none; border-left:none;background-color:#EFEFEF">有效截止日期</div>
                <div class="col-1" style="border-bottom:none; border-left:none;line-height:48px;background-color:#EFEFEF">免费行李额</div>


                <div class="col-2" style="border-bottom:none; border-top:none;background-color:#EFEFEF">GOOD FOR PASSAGE  POINTSOUTLINED</div>
                <div class="col-1" style="border-bottom:none; border-left:none; border-top:none;background-color:#EFEFEF">CARRIER</div>
                <div class="col-1" style="border-bottom:none; border-left:none; border-top:none;background-color:#EFEFEF">FLIGHT</div>
                <div class="col-1" style="border-bottom:none; border-left:none; border-top:none;background-color:#EFEFEF">CLASS</div>
                <div class="col-1" style="border-bottom:none; border-left:none; border-top:none;background-color:#EFEFEF">DATE</div>
                <div class="col-1" style="border-bottom:none; border-left:none; border-top:none;background-color:#EFEFEF">TIME</div>
                <div class="col-1" style="border-bottom:none; border-left:none; border-top:none;background-color:#EFEFEF">STATUS</div>
                <div class="col-1" style="border-bottom:none; border-left:none; border-top:none;background-color:#EFEFEF">FARE BASIS<br />DESIGNATOR</div>
                <div class="col-1" style="border-bottom:none; border-left:none; border-top:none;background-color:#EFEFEF">NOT VALID BEFORE</div>
                <div class="col-1" style="border-bottom:none; border-left:none; border-top:none;background-color:#EFEFEF">NOT VALID VFTER</div>
                <div class="col-1" style="border-bottom:none; border-left:none; border-top:none;background-color:#EFEFEF">ALIOW</div>

                <!--第六行-->
                <div class="col-1" style="border-bottom:none;">自<br />FROM</div>
                <div class="col-1" style="border-bottom:none; border-left:none; line-height:48px;font-weight: bolder;" id="dFrom"></div>
                <div class="col-1" style="border-bottom:none; border-left:none; line-height:48px;font-weight: bolder;"></div>
                <div class="col-1" style="border-bottom:none; border-left:none; line-height:48px;font-weight: bolder;" id="dFlightCode"></div>
                <div class="col-1" style="border-bottom:none; border-left:none; line-height:48px;font-weight: bolder;" id="dCabinTypeName"></div>
                <div class="col-1" style="border-bottom:none; border-left:none; font-weight: bolder;" id="dDateStr"></div>
                <div class="col-1" style="border-bottom:none; border-left:none; line-height:48px;font-weight: bolder;" id="departureTime"></div>
                <div class="col-1" style="border-bottom:none; border-left:none; line-height:48px;font-weight: bolder;">OK</div>
                <div class="col-1" style="border-bottom:none; border-left:none; line-height:48px;font-weight: bolder;" id="dCabinTypeName"></div>
                <div class="col-1" style="border-bottom:none; border-left:none;font-weight: bolder;" id="dDStar"></div>
                <div class="col-1" style="border-bottom:none; border-left:none;font-weight: bolder;" id="dETime"></div>
                <div class="col-1" style="border-bottom:none; border-left:none; line-height:48px;font-weight: bolder;">20KG</div>

                <!--第七行-->
                <div class="col-1" style="border-bottom:none;">至<br />TO</div>
                <div class="col-1" style="border-bottom:none; border-left:none; line-height:48px;font-weight: bolder;" id="dTo"></div>
                <div class="col-1" style="border-bottom:none; border-left:none;border-top:none; line-height:48px;font-weight: bolder;"></div>
                <div class="col-1" style="border-bottom:none; border-left:none;border-top:none; line-height:48px;font-weight: bolder;"></div>
                <div class="col-1" style="border-bottom:none; border-left:none;border-top:none; line-height:48px;font-weight: bolder;"></div>
                <div class="col-1" style="border-bottom:none; border-left:none;border-top:none; line-height:48px;font-weight: bolder;"></div>
                <div class="col-1" style="border-bottom:none; border-left:none;border-top:none; line-height:48px;font-weight: bolder;"></div>
                <div class="col-1" style="border-bottom:none; border-left:none;border-top:none; line-height:48px;font-weight: bolder;"></div>
                <div class="col-1" style="border-bottom:none; border-left:none;border-top:none; line-height:48px;font-weight: bolder;"></div>
                <div class="col-1" style="border-bottom:none; border-left:none;border-top:none; line-height:48px;font-weight: bolder;"></div>
                <div class="col-1" style="border-bottom:none; border-left:none;border-top:none; line-height:48px;font-weight: bolder;"></div>
                <div class="col-1" style="border-bottom:none; border-left:none;border-top:none; line-height:48px;font-weight: bolder;"></div>

                <!--第八行-->
                <div class="col-2" style="border-bottom:none;">票价<br />FARE</div>
                <div class="col-1" style="border-bottom:none; border-left:none; line-height:48px;font-weight: bolder;" id="dPrice"></div>
                <div class="col-2" style="border-bottom:none; border-left:none;">付款方式<br />FORM OFPAYMENT</div>
                <div class="col-7" style="border-bottom:none; border-left:none; line-height:48px;font-weight: bolder;">虚拟支付</div>

                <div class="col-2" style="border-bottom:none">实付等值货币<br />EQUIV.FARE PD. </div>
                <div class="col-1" style="border-bottom:none; border-left:none;font-weight: bolder;" id="dPrice2"></div>
                <div class="col-2" style="border-bottom:none; border-left:none;line-height:48px;">票价计算</div>
                <div class="col-7" style="border-bottom:none; border-left:none; line-height:48px;font-weight: bolder;">支付金额 = 总金额 - 代理费（总金额*3%）</div>

                <!--第九行-->
                <div class="col-2" style="border-bottom:none;">税款<br />TAX</div>
                <div class="col-1" style="border-bottom:none; border-left:none; line-height:48px;font-weight: bolder;">0</div>
                <div class="col-1" style="border-bottom:none; border-left:none;">总数<br />TOTAL</div>
                <div class="col-1" style="border-bottom:none; border-left:none; line-height:48px;font-weight: bolder;" id="dPrice3"></div>
                <div class="col-7" style="border-bottom:none; border-left:none;">旅客须知:  SUBJECT TO CONDITIONS  OF CONTRACT ON THE ITINERARY</div>

                <!--第十行-->
                <div class="col-1" style="border-bottom:none;background-color:#EFEFEF">票联<br />CPN</div>
                <div class="col-2" style="border-bottom:none; border-left:none;background-color:#EFEFEF">航空公司代号<br />AIRLINE CODE</div>
                <div class="col-2" style="border-bottom:none; border-left:none;background-color:#EFEFEF">客票顺序号<br />FORM AND SERIAL NUMBER</div>
                <div class="col-1" style="border-bottom:none; border-left:none;background-color:#EFEFEF">检查号<br />CK</div>
                <div class="col-1" style="border-bottom:none; border-left:none;background-color:#EFEFEF">原出票ORIGINAL ISSUE</div>
                <div class="col-1" style="border-bottom:none; border-left:none;background-color:#EFEFEF">凭证号DOCUMENT NUMBER</div>
                <div class="col-1" style="border-bottom:none; border-left:none;background-color:#EFEFEF">地点<br />PLACE</div>
                <div class="col-1" style="border-bottom:none; border-left:none;background-color:#EFEFEF">日期<br />DATE</div>
                <div class="col-2" style="border-bottom:none; border-left:none;background-color:#EFEFEF">营业员号<br />AGENT'S NUMERICCODE</div>

                <div class="col-1" style="border-bottom:none;font-weight: bolder;" id="dTicketNo"></div>
                <div class="col-2" style="border-bottom:none; line-height:48px;border-left:none;font-weight: bolder;">中国东方航空公司</div>
                <div class="col-2" style="border-bottom:none; line-height:48px; border-left:none;font-weight: bolder;" id="dNo"></div>
                <div class="col-1" style="border-bottom:none; border-left:none;font-weight: bolder;"></div>
                <div class="col-1" style="border-bottom:none; line-height:48px; border-left:none;font-weight: bolder;" id="dPNo"></div>
                <div class="col-1" style="border-bottom:none; border-left:none;font-weight: bolder;" id="dTicketNo2"></div>
                <div class="col-1" style="border-bottom:none; border-left:none;font-weight: bolder;" id="dS"></div>
                <div class="col-1" style="border-bottom:none; border-left:none;font-weight: bolder;" id="dDate"></div>
                <div class="col-2" style="border-bottom:none; line-height:48px; border-left:none;font-weight: bolder;" id="dJobNumber"></div>

                <!--状态栏-->
                <div class="col-3" style="line-height:48px;background-color:#EFEFEF">票联状态:</div>
                <div class="col-3" style="border-left:none;line-height:48px;line-height:48px;font-weight: bolder;" id="dTicketStatus"></div>
                <div class="col-3" style="border-left:none;line-height:48px;background-color:#EFEFEF">发票状态:</div>
                <div class="col-3" style="border-left:none;line-height:48px;line-height:48px;font-weight: bolder;" id="dInvoiceStatus"></div>
            </div>
            <div class="row mt-3" id="btnS">
                <div class="col-12 text-center">
                    <div class="form-group">
                        <button type="button" class="btn btn-outline-primary mr-1" onclick="doPrint()">打印</button>
                        <button type="button" class="btn btn-primary mr-1" onclick="back()">返回</button>
                    </div>
                </div>
            </div>
            <input type="hidden" id="ETicketID" value="@ViewBag.ETicketID" />
        </div>
    </div>
    <script src="~/Content/Js/jquery-3.2.1.min.js"></script>
    <script src="~/Content/bootstrap-4.1.3-dist/js/bootstrap.min.js"></script>
    <script src="~/Content/layui/layui.js"></script>
    <script type="text/javascript">
        var layer;
        //获取主键ID
        var ETicketID = $("#ETicketID").val();
        $(function ()
        {
            //layui.use('layer', function ()
            //{
            //    layer=layui.layer
            //})
            $.getJSON("/ElectronicsTicket/TicketPrint/SelectTicketById?ETicketID=" + ETicketID,
                function (data)
                {
                    if (data != null) {
                        //数据回填
                        $("#dLine").text(data.orangeName + "/" + data.destinationName);//始发地/目的地
                        $("#dSeatNu").text(data.seatNum);//定座记录编号
                        $("#dTimeAndStation").text(data.TicketingTime + "/" + data.orangeName); //出票日期和地点
                        $("#dUserName").text(data.userName);//营业员
                        $("#dJobNumber").text(data.JobNumber);//营业员号码

                        $("#dPassengerName").text(data.passengerName);//旅客姓名
                        $("#dPassengerNo").text(data.passengerNo);//旅客编号
                        $("#dFlightCode").text(data.flightCode);//航班号
                        $("#dCabinTypeName").text(data.cabinTypeName);//座位等级
                        $("#dDateStr").text(data.flightDateStr);//航班日期
                        $("#departureTime").text(data.departureTime);//起飞时间
                        $("#dDStar").text(data.TicketingTime);//客票生效日期
                        $("#dETime").text(data.flightDateStr);//有效截止日期
                        $("#dFrom").text(data.orangeName);//自 FROM
                        $("#dTo").text(data.destinationName);// 至 TO


                        $("#dCabinTypeName").text(data.cabinTypeName);//定座类别                 
                        $("#dStard").text(data.orangeName);//始发地
                        $("#dEnd").text(data.destinationName);//目的地
                        $("#dPrice").text(data.ticketPrice);//票价
                        $("#dPrice2").text(data.ticketPrice + "人民币");//实付等值货币
                        $("#dPrice3").text(data.ticketPrice);//总数



                        $("#dNo").text(data.passengerNo);//客票顺序号=旅客编号
                        $("#dPNo").text(data.passengerNo);//原出票

                        $("#dTicketNo").text(data.ticketNo);//票联
                        $("#dTicketNo2").text(data.ticketNo);//票号

                        $("#dS").text(data.orangeName);//始发地
                        $("#dDate").text(data.flightDateStr);//日期

                        $("#dTicketStatus").text(data.eTicketStatus + "/" + data.EnglishName);//联票状态
                        $("#dInvoiceStatus").text(data.invoiceStatus);//发票状态   

                        //------模态框数据回填
                        //(1) ET航班更改
                        $("#ETPNRNo").attr("value", data.PNRNo);
                        $("#PNRSegmentID").attr("value", data.PNRSegmentID);//隐藏域的值
                        //(2) 电子客票换开
                        $("#CpassengerNo").attr("value", data.passengerNo);//旅客编号

                        //(3) 作废
                        $("#IPrice").html(data.ticketPrice);//票价

                        //(4)退票
                        $("#RPrice").html(data.ticketPrice);//票价
                    } else
                    {
                        layer.alert("当前数据不存在！", { icon: 0, title: '提交失败', offset: '100px' });
                    }

                })


        })
        
        function doPrint()
        {
            var layerIndex=layer.load();
            $.post("/ElectronicsTicket/TicketPrint/doT4Print", {
                eTicketID:ETicketID,
            }, function (jsonData) {
                layer.close(layerIndex);
                layer.alert(jsonData.Text);
                if (jsonData.State) {
                    //隐藏标题 按钮 横线(样式)
                    $("h4").hide();
                    $("#btnS").hide();
                    $(".p-3").removeClass("content");
                    window.print();
                    //显示内容
                    $("#title").show();
                    $("#btnS").show();
                    $(".p-3").addClass("content");
                    //刷新网页
                    location.reload();
                }
              
            })
            
        }
    </script>
</body>
</html>
