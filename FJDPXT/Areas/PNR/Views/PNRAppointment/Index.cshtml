@using FJDPXT.Model

@{
    Layout = null;
    List<S_Airport> airports = ViewBag.airports;
    
}
<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
    <link href="~/Content/layui/css/layui.css" rel="stylesheet" />
    <!--bootstrap 框架样式表-->
    <link href="~/Content/bootstrap-4.1.3-dist/css/bootstrap.min.css" rel="stylesheet" />
    <!--后台模板中的字体图标css样式-->
    <link href="~/Content/app-assets/fonts/simple-line-icons/style.css" rel="stylesheet" />

    <style>
        /* 去除 tab 标题背景和圆角 */
        .nav-pills .nav-link {
            border-bottom: 2px solid #ffffff;
            border-radius: 0px;
        }

            /* 选中tab 标题下划线 */
            .nav-pills .nav-link.active {
                color: #000000;
                background-color: white;
                border-bottom: 2px solid #007bff;
            }

        /* .laydate_box, .laydate_box * { box-sizing:content-box;} */
    </style>
</head>
<body>
    <div class="container">
        <div class="row mt-4">
            <div class="col-12 text-center">
                <h2 id="h2Title">PNR预订</h2>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                @* 滑动门 /components/navs.html *@
                @*滑动门头部标签部分*@
                <ul class="nav nav-pills mb-3 justify-content-center" id="pills-tab" role="tablist">
                    <li class="nav-item" id="One-way">
                        <a class="nav-link active" id="pane-one-way-tab" data-toggle="pill" href="#pane-one-way" role="tab" aria-controls="pills-home" aria-selected="true">单程</a>@*aria-selected 默认是否选中*@
                    </li>
                    <li class="nav-item" id="liRoundTrip">
                        <a class="nav-link" id="pane-round-trip-tab" data-toggle="pill" href="#pane-round-trip" role="tab" aria-controls="pills-profile" aria-selected="false">来回程</a>
                    </li>
                    <li class="nav-item" id="liConnectingFlight">
                        <a class="nav-link" id="pane-connecting-flight-tab" data-toggle="pill" href="#pane-connecting-flight" role="tab" aria-controls="pills-contact" aria-selected="false">联程</a>
                    </li>
                </ul>
                @*滑动门内容部分*@
                <div class="tab-content" id="pills-tabContent">
                    @* 单程 *@
                    <div class="tab-pane fade show active" id="pane-one-way" role="tabpanel" aria-labelledby="pills-home-tab">
                        <div class="row justify-content-center">
                            <div class="col-sm-12 col-md-8">
                                @*layui-form 标识一个表单元素块为layui的表单，
                                    注意：一旦使用layui-form，如果不加载form模块，select、checkbox、radio等将无法显示，并且无法使用form相关功能*@
                                <form class="layui-form">
                                    <div class="form-row">
                                        <label class="col-6 col-form-label"><i class="icon-plane"></i>&nbsp;&nbsp;航空公司:中国东方航空公司</label>
                                    </div>
                                    <div class="form-row">
                                        <label class="col-1 col-form-label"><i class="icon-arrow-up"></i>&nbsp;&nbsp;<b>从</b></label>
                                        <label class="col-2 col-xl-1 col-form-label">城市：</label>
                                        <div class="col-3 col-lg-2">
                                            <input type="text" class="form-control" readonly="" placeholder="城市代码" />
                                        </div>
                                        <div class="col-6 col-lg-7 col-xl-8 layui-form-item">
                                            <select name="city1" lay-verify="" lay-search class="form-control ow-airport">
                                                <option value="0" data-code=""></option>
                                                @foreach (S_Airport airport in airports)
                                                {
                                                    <option value="@airport.airportID" data-code="@airport.airportCode">@(airport.cityName + "[" + airport.airportName + "]")</option>
                                                }
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <label class="col-1 col-form-label"><i class="icon-arrow-down"></i>&nbsp;&nbsp;<b>到</b></label>
                                        <label class="col-2 col-xl-1 col-form-label">城市：</label>
                                        <div class="col-3 col-lg-2">
                                            <input type="text" class="form-control" readonly="" placeholder="城市代码" />
                                        </div>
                                        <div class="col-6 col-lg-7 col-xl-8 layui-form-item">
                                            <select name="city2" lay-verify="" lay-search class="form-control ow-airport">
                                                <option value="0" data-code=""></option>
                                                @foreach (S_Airport airport in airports)
                                                {
                                                    <option value="@airport.airportID" data-code="@airport.airportCode">@(airport.cityName + "[" + airport.airportName + "]")</option>
                                                }
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <label class="col-3 col-xl-2 col-form-label"><i class="icon-calendar"></i>&nbsp;&nbsp;出发日期</label>
                                        <div class="col-6 col-xl-4">
                                            <input type="text" class="form-control myLayDate" id="ow-startDate" autocomplete="off"/>
                                        </div>
                                    </div>
                                    <div class="form-row justify-content-center mt-3">
                                        <div class="col-2">
                                            <button type="button" class="btn btn-block btn-primary" id="ow-btnSearch">查询</button>
                                        </div>
                                        <div class="col-2 d-none" >
                                            <button type="button" class="btn btn-block btn-primary btnCancel" id="ow-btnSearch">取消</button>
                                        </div> 
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    @* 往返程 *@
                    <div class="tab-pane fade" id="pane-round-trip" role="tabpanel" aria-labelledby="pills-profile-tab">
                        <div class="row">
                            <div class="col-sm-12 col-md-8 offset-md-2">
                                <form class="layui-form">
                                    <div class="form-row">
                                        <label class="col-6 col-form-label"><i class="icon-plane"></i>&nbsp;&nbsp;航空公司:中国东方航空公司</label>
                                    </div>
                                    <div class="form-row">
                                        <label class="col-1 col-form-label"><i class="icon-arrow-up"></i>&nbsp;&nbsp;<b>从</b></label>
                                        <label class="col-2 col-xl-1 col-form-label">城市：</label>
                                        <div class="col-3 col-lg-2">
                                            <input type="text" class="form-control" readonly="" placeholder="城市代码" />
                                        </div>
                                        <div class="col-6 col-lg-7 col-xl-8 layui-form-item">
                                            <select name="city" lay-verify="" lay-search class="form-control rt-airport" id="rt-airport1" lay-filter="rt-airport1">
                                                <option value="0" data-code=""></option>
                                                @foreach (S_Airport airport in airports)
                                                {
                                                    <option value="@airport.airportID" data-code="@airport.airportCode">@(airport.cityName + "[" + airport.airportName + "]")</option>
                                                }
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <label class="col-1 col-form-label"><i class="icon-arrow-right"></i>&nbsp;&nbsp;<b>到</b></label>
                                        <label class="col-2 col-xl-1 col-form-label">城市：</label>
                                        <div class="col-3 col-lg-2">
                                            <input type="text" class="form-control" readonly="" placeholder="城市代码" />
                                        </div>
                                        <div class="col-6 col-lg-7 col-xl-8 layui-form-item">
                                            <select name="city" lay-verify="" lay-search class="form-control rt-airport">
                                                <option value="0" data-code=""></option>
                                                @foreach (S_Airport airport in airports)
                                                {
                                                    <option value="@airport.airportID" data-code="@airport.airportCode">@(airport.cityName + "[" + airport.airportName + "]")</option>
                                                }
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <label class="col-1 col-form-label"><i class="icon-arrow-down"></i>&nbsp;&nbsp;<b>回</b></label>
                                        <label class="col-2 col-xl-1 col-form-label">城市：</label>
                                        <div class="col-3 col-lg-2">
                                            <input type="text" class="form-control" readonly="readonly" placeholder="城市代码" id="rt-code3" />
                                        </div>
                                        <div class="col-6 col-lg-7 col-xl-8 layui-form-item">
                                            <input type="text" class="form-control" id="rt-airport3" readonly="readonly" />
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <label class="col-3 col-xl-2 col-form-label"><i class="icon-calendar"></i>&nbsp;&nbsp;出发日期</label>
                                        <div class="col-9 col-xl-3">
                                            <input type="text" class="form-control myLayDate" id="rt-startDate" autocomplete="off"/>
                                        </div>
                                        <div class="col-12 col-xl-1 m-2 m-xl-0"></div>
                                        <label class="col-3 col-xl-2 col-form-label"><i class="icon-calendar"></i>&nbsp;&nbsp;返回日期</label>
                                        <div class="col-9 col-xl-3">
                                            <input type="text" class="form-control myLayDate" id="rt-returnDate" autocomplete="off"/>
                                        </div>
                                    </div>
                                    <div class="form-row mt-5 justify-content-center">
                                        <div class="col-2">
                                            <button type="button" class="btn btn-block btn-primary" id="rt-btnSearch">查询</button>
                                        </div>
                                        <div class="col-2 d-none">
                                            <button type="button" class="btn btn-block btn-primary btnCancel" id="ow-btnSearch">取消</button>
                                        </div> 
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    @* 联程 *@
                    <div class="tab-pane fade" id="pane-connecting-flight" role="tabpanel" aria-labelledby="pills-contact-tab">
                        <div class="row">
                            <div class="col-sm-12 col-md-8 offset-md-2">
                                <form class="layui-form">
                                    <div class="form-row ">
                                        <label class="col-6 col-form-label"><i class="icon-plane"></i>&nbsp;&nbsp;航空公司:中国东方航空公司</label>
                                        <div class="col-6 row justify-content-end">
                                            <button type="button" class="btn btn-sm btn-primary" id="cf-add"><i class="layui-icon layui-icon-add-1"></i></button>
                                            <button type="button" class="btn btn-sm btn-primary ml-1" id="cf-remove"><i class="layui-icon layui-icon-delete"></i></button>
                                        </div>
                                    </div>
                                    <div class="form-row cf-segment mt-3">
                                        <label class="col-1 col-form-label"><i class="icon-arrow-up"></i>&nbsp;&nbsp;<b>从</b></label>
                                        <label class="col-2 col-xl-1 col-form-label">城市：</label>
                                        <div class="col-3 col-lg-2">
                                            <input type="text" class="form-control" readonly="" placeholder="城市代码" />
                                        </div>
                                        <div class="col-6 col-lg-7 col-xl-3 layui-form-item">
                                            <select name="city" lay-verify="" lay-search class="form-control cf-airport">
                                                <option value="0" data-code=""></option>
                                                @foreach (S_Airport airport in airports)
                                                {
                                                    <option value="@airport.airportID" data-code="@airport.airportCode">@(airport.cityName + "[" + airport.airportName + "]")</option>
                                                }
                                            </select>
                                        </div>
                                        <div class="col-12 d-xl-none"></div>
                                        <label class="col-3 col-xl-2 col-form-label"><i class="icon-calendar"></i>&nbsp;&nbsp;起飞日期</label>
                                        <div class="col-9 col-xl-3">
                                            <input type="text" class="form-control cf-date myLayDate" id="cf-date1" autocomplete="off"/>
                                        </div>
                                    </div>
                                    <div class="form-row cf-segment mt-3 mt-xl-0">
                                        <label class="col-1 col-form-label"><i class="icon-arrow-right"></i>&nbsp;&nbsp;<b>到</b></label>
                                        <label class="col-2 col-xl-1 col-form-label">城市：</label>
                                        <div class="col-3 col-lg-2">
                                            <input type="text" class="form-control" readonly="" placeholder="城市代码" />
                                        </div>
                                        <div class="col-6 col-lg-7 col-xl-3 layui-form-item">
                                            <select name="city" lay-verify="" lay-search class="form-control cf-airport">
                                                <option value="0" data-code=""></option>
                                                @foreach (S_Airport airport in airports)
                                                {
                                                    <option value="@airport.airportID" data-code="@airport.airportCode">@(airport.cityName + "[" + airport.airportName + "]")</option>
                                                }
                                            </select>
                                        </div>
                                        <div class="col-12 d-xl-none"></div>
                                        <label class="col-3 col-xl-2 col-form-label"><i class="icon-calendar"></i>&nbsp;&nbsp;起飞日期</label>
                                        <div class="col-9 col-xl-3">
                                            <input type="text" class="form-control cf-date myLayDate" id="cf-date2" autocomplete="off"/>
                                        </div>
                                    </div>
                                    <div class="form-row cf-segment  mt-3 mt-xl-0">
                                        <label class="col-1 col-form-label"><i class="icon-arrow-right"></i>&nbsp;&nbsp;<b>到</b></label>
                                        <label class="col-2 col-xl-1 col-form-label">城市：</label>
                                        <div class="col-3 col-lg-2">
                                            <input type="text" class="form-control" readonly="" placeholder="城市代码" />
                                        </div>
                                        <div class="col-6 col-lg-7 col-xl-3 layui-form-item">
                                            <select name="city" lay-verify="" lay-search class="form-control cf-airport">
                                                <option value="0" data-code=""></option>
                                                @foreach (S_Airport airport in airports)
                                                {
                                                    <option value="@airport.airportID" data-code="@airport.airportCode">@(airport.cityName + "[" + airport.airportName + "]")</option>
                                                }
                                            </select>
                                        </div>
                                        <div class="col-12 d-xl-none"></div>
                                        <label class="col-3 col-xl-2 col-form-label d-none"><i class="icon-calendar"></i>&nbsp;&nbsp;起飞日期</label>
                                        <div class="col-9 col-xl-3 d-none">
                                            <input type="text" class="form-control cf-date myLayDate" id="cf-date3" autocomplete="off"/>
                                        </div>
                                    </div>

                                    <div class="form-row cf-segment d-none  mt-3 mt-xl-0">
                                        <label class="col-1 col-form-label"><i class="icon-arrow-right"></i>&nbsp;&nbsp;<b>到</b></label>
                                        <label class="col-2 col-xl-1 col-form-label">城市：</label>
                                        <div class="col-3 col-lg-2">
                                            <input type="text" class="form-control" readonly="" placeholder="城市代码" />
                                        </div>
                                        <div class="col-6 col-lg-7 col-xl-3 layui-form-item">
                                            <select name="city" lay-verify="" lay-search class="form-control cf-airport">
                                                <option value="0" data-code=""></option>
                                                @foreach (S_Airport airport in airports)
                                                {
                                                    <option value="@airport.airportID" data-code="@airport.airportCode">@(airport.cityName + "[" + airport.airportName + "]")</option>
                                                }
                                            </select>
                                        </div>
                                        <div class="col-12 d-xl-none"></div>
                                        <label class="col-3 col-xl-2 col-form-label d-none"><i class="icon-calendar"></i>&nbsp;&nbsp;起飞日期</label>
                                        <div class="col-9 col-xl-3 d-none">
                                            <input type="text" class="form-control cf-date myLayDate" id="cf-date4" autocomplete="off"/>
                                        </div>
                                    </div>


                                    <div class="form-row cf-segment d-none mt-3 mt-xl-0">
                                        <label class="col-1 col-form-label"><i class="icon-arrow-right"></i>&nbsp;&nbsp;<b>到</b></label>
                                        <label class="col-2 col-xl-1 col-form-label">城市：</label>
                                        <div class="col-3 col-lg-2">
                                            <input type="text" class="form-control" readonly="" placeholder="城市代码" />
                                        </div>
                                        <div class="col-6 col-lg-7 col-xl-3 layui-form-item">
                                            <select name="city" lay-verify="" lay-search class="form-control cf-airport">
                                                <option value="0" data-code=""></option>
                                                @foreach (S_Airport airport in airports)
                                                {
                                                    <option value="@airport.airportID" data-code="@airport.airportCode">@(airport.cityName + "[" + airport.airportName + "]")</option>
                                                }
                                            </select>
                                        </div>
                                        <div class="col-12 d-xl-none"></div>
                                        <label class="col-3 col-xl-2 col-form-label d-none"><i class="icon-calendar"></i>&nbsp;&nbsp;起飞日期</label>
                                        <div class="col-9 col-xl-3 d-none">
                                            <input type="text" class="form-control cf-date myLayDate" id="cf-date5" autocomplete="off"/>
                                        </div>
                                    </div>


                                    <div class="form-row cf-segment d-none mt-3 mt-xl-0">
                                        <label class="col-1 col-form-label"><i class="icon-arrow-right"></i>&nbsp;&nbsp;<b>到</b></label>
                                        <label class="col-2 col-xl-1 col-form-label">城市：</label>
                                        <div class="col-3 col-lg-2">
                                            <input type="text" class="form-control" readonly="" placeholder="城市代码" />
                                        </div>
                                        <div class="col-6 col-lg-7 col-xl-3 layui-form-item">
                                            <select name="city" lay-verify="" lay-search class="form-control cf-airport">
                                                <option value="0" data-code=""></option>
                                                @foreach (S_Airport airport in airports)
                                                {
                                                    <option value="@airport.airportID" data-code="@airport.airportCode">@(airport.cityName + "[" + airport.airportName + "]")</option>
                                                }
                                            </select>
                                        </div>
                                    </div>

                                    <div class="form-row mt-5 justify-content-center" id="cf-btns">
                                        <div class="col-2">
                                            <button type="button" class="btn btn-block btn-primary" id="cf-btnSearch">查询</button>
                                        </div>
                                        <div class="col-2 d-none">
                                            <button type="button" class="btn btn-block btn-primary btnCancel" id="ow-btnSearch">取消</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <input type="hidden" id="history_back" />
    <script src="~/Content/app-assets/vendors/js/core/jquery-3.3.1.min.js"></script>
    <script src="~/Content/bootstrap-4.1.3-dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/Content/layui/layui.js"></script>
    <script src="~/Content/js/customfunction.js"></script>

    <script>
        var layuiForm, layer, laydate;//layui的模块
        var dateRegex = /^\d{4}([-/.]\d{2}){2}$/;
        
        $(function () {
            //=================PNR复制====================
            //声明变量
            //var isCopy = false;
            //获取PNR复制标志
            var pnrCopy = sessionStorage.getItem("copyPNR");
            if (pnrCopy != null && pnrCopy == "true") {
                $(".btnCancel").parent().removeClass("d-none");
            }

            //=================PNR复制====================


            //=======================PNR添加航段========================
            //获取添加航段的标志
            var addSegment = sessionStorage.getItem("addSegment");
            //获取航段数
            var SegmentNum=sessionStorage.getItem("addSegment_pnrSegmentNum");
            //获取PNRID
            var pnrID=sessionStorage.getItem("addSegment_PNRID");

            if (addSegment != null && addSegment == "true")
            {
                //修改标题
                $("#h2Title").text("添加航段")

                //判断当前的PNR航段数是否为4
                if (SegmentNum == 4)
                {
                    $("#liRoundTrip").addClass("d-none");
                    $("#liConnectingFlight").addClass("d-none");
                }
                //if (SegmentNum == 4) {
                //    $("#liRoundTrip").addClass("d-none");
                //    $("#One-way").addClass("d-none");
                //    $.post("FourSegment=PNRID" + pnrID);
                //dbPNRSegments.segment
                //}
                else if (SegmentNum >= 5)
                {
                    myAlert("该PNR已经到达最大值（5段），无法继续添加航段了");
                    window.location.replace("PNR/PNRQuery/PnrInfoShow?PNRID=" +PNRID);
                }
                //显示“取消”按钮
                $(".btnCancel").parent().removeClass("d-none");

            }

            //=======================PNR添加航段========================

            //=======================ET航班更改========================
            var ChangeFlight = sessionStorage.getItem("ETChangeFlight");
            var dbFlightChange = JSON.parse(sessionStorage.getItem("changeData"));
            var INChangeFlight = sessionStorage.getItem("INChangeFlight");

            if ((ChangeFlight != null && ChangeFlight == "true") || (INChangeFlight != null && INChangeFlight == "true"))
            {
                //修改标题
                $("#h2Title").text("ET航班更改");
                //隐藏联程&往返程
                $("#liRoundTrip").addClass("d-none");
                $("#liConnectingFlight").addClass("d-none");
                //显示"取消"按钮
                $(".btnCancel").parent().removeClass("d-none");
            }

            //=======================ET航班更改========================
            //取消按钮点击事件
            $(".btnCancel").click(function ()
            {
                //取消PNR复制
                if (pnrCopy != null && pnrCopy == "true") {
                    sessionStorage.removeItem("copyPNR");
                    window.location.href = "/PNR/PNRQuery/PNRQuery";
                }
                //取消PNR添加航段
                if (addSegment != null && addSegment == "true") {
                    //移除添加航段的标志
                    sessionStorage.removeItem("addSegment");
                    window.location.href = "/PNR/PNRQuery/PNRQuery";
                }
                //取消航班更改
                if (ChangeFlight != null && ChangeFlight == "true") {
                    //移除更改航班的标志
                    sessionStorage.removeItem("ETChangeFlight");
                    window.location.href = "/ElectronicsTicket/TicketModify/showTicketInfor?eTicketID=" + dbFlightChange.eTicketID;
                }

            })


            layui.use(['form', 'layer', 'laydate'], function () {
                layuiForm = layui.form;
                layer = layui.layer;
                laydate = layui.laydate;

                //初始化laydate
                $('.myLayDate').each(function () {
                    laydate.render({
                        elem: this,//要初始化的元素 ，值为选择器(一般为id选择器，不要使用class选择器，会导致只有第一个可以绑定上)，或DOM对象
                        type: 'date',
                        min:0,//限制最小可选择的日期为今天
                        btns: ['now', 'confirm'],
                        trigger: 'click'//采用click弹出

                    });
                });
                //====layui.form监听select选择 语法 form.on('select(filter)', function(data){})  如果你想监听所有的select，去掉过滤器(filter)即可
                //监听所有下拉框 - 在select元素前的input框显示所选择机场的三字码
                layuiForm.on('select', function (data) {
                    //console.log(data.elem); //得到select原始DOM对象
                    //console.log(data.value); //得到被选中的值
                    //console.log(data.othis); //得到美化后的DOM对象

                    //获取显示机场三字码的input
                    var input = $(data.elem).parent().prev().children().eq(0);//(data.elem)的父元素的兄弟元素的子元素的第一个属性值
                    //获取选中机场的三字码
                    var strCode = $(data.elem).children('option[value="' + data.value + '"]').data("code");
                    //将三字码显示在文本框中
                    input.val(strCode);
                });
                layuiForm.on('select(rt-airport1)', function (data) {
                    //获取选择的option
                    var option = $(data.elem).children('option[value="' + data.value + '"]');
                    //显示返程的城市机场三字码
                    $("#rt-code3").val(option.data("code"));
                    //$("rt-code3").val() = $(data.elem).children('option[value="' + data.value + '"]').data("code");
                    //显示返程城市机场的名称
                    $("#rt-airport3").val(option.text().trim());
                });
            });
            //=============联程部分 添加航段
            $("#cf-add").click(function () {
                var segment = $('.cf-segment');//获取所有的航段 不管隐藏还是显示
                var hiddensegment = $('.cf-segment.d-none');//获取所有隐藏航段
                //判断是否有隐藏状态的form-row
                if (hiddensegment.length > 0) {
                    //把隐藏航段的第一个显示出来
                    hiddensegment.eq(0).removeClass('d-none');
                    //把隐藏的第一个日期选择控件 显示出来
                    segment.eq(segment.length - 1 - hiddensegment.length).children(':gt(3)').removeClass('d-none');
                }                  //6-1-3=2(第三行的索引)
                else {
                    myAlert("最多只能添加五个航段");
                }
            })

            //=============联程部分 移除航段
            $("#cf-remove").click(function () {
                var segment = $('.cf-segment').not(".d-none");//获取联程中没有隐藏的from-row
                var hiddensegment = $('.cf-segment.d-none');//获取所有隐藏航段
                if (hiddensegment.length < 3) {
                    //隐藏最后一个航段
                    segment.eq(segment.length - 1).addClass('d-none');
                    //把显示的最后一个日期控件隐藏起来
                    segment.eq(segment.length - 2).children(':gt(3)').addClass('d-none');
                } else {
                    myAlert("最少要有2个航段");
                }
            })


            //=======查询按钮=======
            //单程
            $("#ow-btnSearch").click(function () {
                //获取参数
                //起飞/降落机场ID
                var airports = [];//存放机场的ID;
                $('.ow-airport').each(function () {
                    var airport = parseInt($(this).val());
                    airports.push(airport);
                })
                //起飞日期
                var dates = [];
                dates.push($("#ow-startDate").val());

                //数据验证
                //起飞机场ID不能为0
                if (airports[0] == undefined || airports[0] == 0) {
                    myAlert("请选择起飞机场", "提示", 0)
                    return;
                }
                //降落机场ID不能为0
                if (airports[1] == undefined || airports[1] == 0) {
                    myAlert("请选择降落机场", "提示", 0)
                    return;
                }
                //起飞机场不能和降落机场相同
                if (airports[0] == airports[1]) {
                    myAlert("起飞机场不能和降落机场相同", "提示", 0);
                    return;
                }
                //验证选择的起飞日期
                if (dates[0] == undefined || !dateRegex.test(dates[0])) {
                    myAlert("请选择起飞日期", "提示", 0);
                    return;
                }
                //构建需要传到航班 舱位选择页面的数据
                var airportAndDate = {
                    flightType: 1,          //类型：1-单程
                    segmentNum: 1,          //航段数
                    airports: airports,     //机场城市id数组
                    dates: dates            //日期,数组
                };
                //将需要传递的数据保存到sessionStorage
                sessionStorage.setItem("airportAndDate", JSON.stringify(airportAndDate))

                //跳转到航班 舱位选择页面
                window.location.replace("@Url.Content("~/PNR/PNRAppointment/SelectFlightPage")");
                /*
                HTML5的WebStorage提供了两种API：localStorage（本地存储）和sessionStorage（会话存储）。
               1、localStorage:localStorage的生命周期是永久的，关闭页面或浏览器之后localStorage中的数据也不会消失。
               localStorage除非主动删除数据，否则数据永远不会消失。
               2、sessionStorage的生命周期是在仅在当前会话下有效。sessionStorage引入了一个“浏览器窗口”的概念
               ，sessionStorage是在同源的窗口中始终存在的数据。只要这个浏览器窗口没有关闭，即使刷新页面或者进入同源另一个页面，数据依然存在。
               但是sessionStorage在关闭了浏览器窗口后就会被销毁。同时独立的打开同一个窗口同一个页面，sessionStorage也是不一样的。
               3、localStorage和sessionStorage只能存储字符串类型，对于复杂的对象可以使用ECMAScript提供的JSON对象的stringify和parse来处理
               4、localStorage和sessionStorage的存储数据大小一般都是：5MB
               5、localStorage和sessionStorage都保存在客户端(浏览器)，不与服务器进行交互通信。

               .setItem(key,value); //用于添加和修改保存的数据 key不存在时为添加,key存在时为修改
               .getItem(key);  //获取指定key的value
               .removeItem(key);//移除指定key的数据
                */
            });

           //往返程
            $("#rt-btnSearch").click(function () {
                //=获取参数
                //起飞和降落机场的ID
                var airports = [];//存放选中的机场ID
                $('.rt-airport').each(function () {
                    var airport = parseInt($(this).val());//获取下拉框选中的值-并转为整数
                    airports.push(airport);
                });
                //第三个机场ID和第一个一样
                airports.push(airports[0]);

                //起飞日期
                var dates = [];
                $('#pane-round-trip .myLayDate').each(function () {
                    dates.push($(this).val());
                });

                //=数据验证
                //起飞机场ID不能为0
                if (airports[0]==undefined || airports[0]==0) {
                    myAlert("请选择起飞机场", "提示", 0);
                    return;
                }
                //降落机场
                if (airports[1] == undefined || airports[1] == 0) {
                    myAlert("请选择降落机场", "提示", 0);
                    return;
                }
                //起飞机场 不能和降落机场相同
                if (airports[0] == airports[1]) {
                    myAlert("起飞机场和降落机场不能相同", "提示", 0);
                    return;
                }
                // 验证选择的起飞日期
                if (dates[0] == undefined || !dateRegex.test(dates[0])) {
                    myAlert("请选择起飞日期", "提示", 0);
                    return;
                }
                if (dates[1] == undefined || !dateRegex.test(dates[1])) {
                    myAlert("请选择返程日期", "提示", 0);
                    return;
                }
                //判断返程日期不能小于出发日期
                var startDate = new Date(dates[0]);
                var endDate = new Date(dates[1]);
                if (startDate>endDate) {
                    myAlert("返程日期不能小于出发日期", "提示", 0);
                    return;
                }

                //== 构建需要传递到航班、舱位选择页面的数据
                var airportAndDate = {
                    flightType: 2,          //类型：2-往返程
                    segmentNum: 2,          //航段数
                    airports: airports,     //机场城市id数组
                    dates: dates            //日期,数组
                };

                //将需要传递的数据保存到sessionStorage
                sessionStorage.setItem("airportAndDate", JSON.stringify(airportAndDate));

                console.log(sessionStorage.getItem("airportAndDate"));

                //==跳转到 航班、舱位选择页面
                window.location.replace("@Url.Content("~/PNR/PNRAppointment/SelectFlightPage")");

            });

            //联程
            $("#cf-btnSearch").click(function () {
                //获取参数
                //查询出未隐藏的航段
                var segment = $('.cf-segment:not(.d-none)');
                //起飞/降落机场ID
                var airports = [];//存放机场的ID;
                segment.find('.cf-airport').each(function () {
                    var airport = parseInt($(this).val());
                    airports.push(airport);
                })
                //获取未隐藏的日期选择控件的值
                var dates = [];
                segment.find('div:not(.d-none) .myLayDate').each(function () {
                    dates.push($(this).val());
                })
                //数据验证
                //起飞机场ID不能为0
                for (var i = 0; i < airports.length; i++) {
                    if (airports[i] == undefined || airports[i] == 0) {
                        myAlert("请选择第" + (i + 1) + "个起飞机场", "提示", 0);
                        return;
                    }
                    //起飞机场不能和降落机场相同
                    if (i > 0 && airports[i] == airports[i - 1]) {
                        myAlert("第" + (i) + "个和第" + (i + 1) + "个机场不能相同,请重新选择", "提示", 0);
                        return;
                    }
                }
                //日期遍历部分
                for (var j = 0; j < dates.length; j++) {
                    if (dates[j] == undefined || !dateRegex.test(dates[j])) {
                        myAlert("请选择第" + (j + 1) + "起飞日期", "提示", 0);
                        return;
                    }
                    if (j > 0) {
                        //判断返程日期不能小于出发日期
                        var startDate = new Date(dates[j - 1]);
                        var endDate = new Date(dates[j]);
                        if (startDate > endDate) {
                            myAlert("第" + (j) + "个日期不能大于第" + (j + 1) + "个日期,请重新选择", "提示", 0);
                            return;
                        }
                    }
                }
                //构建需要传到航班 舱位选择页面的数据
                var airportAndDate = {
                    flightType: 3,          //类型：3-联程
                    segmentNum: airports.length - 1,          //航段数
                    airports: airports,     //机场城市id数组
                    dates: dates            //日期,数组
                };
                //将需要传递的数据保存到sessionStorage
                sessionStorage.setItem("airportAndDate", JSON.stringify(airportAndDate))

                //跳转到航班 舱位选择页面
                window.location.replace("@Url.Content("~/PNR/PNRAppointment/SelectFlightPage")");

            });

        });
    </script>
</body>
</html>
